(function(){var extend=function(t,e){function r(){this.constructor=t}for(var n in e)hasProp.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(t,e){"function"==typeof define&&define.amd?define(["lodash","yess"],function(r){return t.PropertyAccessors=e(t,r)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=e(t,require("lodash"),require("yess")):t.PropertyAccessors=e(t,t._)}(this,function(__root__,_){var AbstractProperty,ArgumentError,Error,InstanceProperty,PrototypeProperty,ReadonlyPropertyError,comparator,defineProperty,isClass,isFunction,isObject,supportsConst;return AbstractProperty=function(){function AbstractProperty(){}return AbstractProperty.prototype.build=function(){},AbstractProperty.prototype.defineGetter=function(){var fn;return this.getter?this.options.memo?eval('fn = (function(computer) {\n       return function fn() {\n         var val = this["_'+this.property+'"];\n         if (val == null) {\n           var ref = this["_'+this.property+'"] = computer.call(this);\n           if (val !== ref) { this.notify("change:'+this.property+'", this, ref, val); }\n           return ref;\n         } else { return val; }\n       }\n     })(this.getter);'):fn=function(t){return function(){return t.call(this)}}(this.getter):eval(' fn = function() { return this["_'+this.property+'"]; } '),this.metadata[this.property+"Getter"]=fn},AbstractProperty.prototype.defineSetter=function(){var code;return code=' function fn(value) {\nvar old = this["_'+this.property+'"];',this.options.readonly&&(code+='   if (old != null) {\n  throw new ReadonlyPropertyError(this, "'+this.property+'");\n}'),code+='   if (!comparator(value, old)) {\n    this["_'+this.property+'"] = value;\n    this.notify("change:'+this.property+'", this, value, old);\n  }\n}',eval(code),this.metadata["_"+this.property+"Setter"]=fn,this.metadata[this.property+"Setter"]=this.setter?function(t){return function(e){t.call(this,e)}}(this.setter):fn},AbstractProperty.prototype.defineProperty=function(){return this.target.hasOwnProperty(this.property)?void 0:Object.defineProperty(this.target,this.property,{get:this.metadata[this.property+"Getter"],set:this.metadata[this.property+"Setter"]})},AbstractProperty.prototype.toEvents=function(t){return _.map(t,function(t){return"change:"+t}).join(" ")},AbstractProperty}(),PrototypeProperty=function(superClass){function PrototypeProperty(t,e,r,n,o){this.Class=t,this.property=e,this.getter=r,this.setter=n,this.options=o,PrototypeProperty.__super__.constructor.apply(this,arguments),this.prototype=this.Class.prototype,this.target=this.prototype,this.metadata=this.Class.reopenObject(METADATA),this.initializerKey="property-accessors:events:"+this.property}return extend(PrototypeProperty,superClass),PrototypeProperty.prototype.build=function(){return this.defineGetter(),this.defineSetter(),this.defineProperty(),this.defineCallback()},PrototypeProperty.prototype.defineCallback=function(){var ref;return this.Class.deleteInitializer(this.initializerKey),this.getter&&this.options.memo&&(null!=(ref=this.options.dependencies)?ref.length:void 0)>0?(eval('function fn() {\n  this.on("'+this.toEvents(this.options.dependencies)+'", function() {\n    this["_'+this.property+'"] = null;\n    this["'+this.property+'"];\n  });\n}'),this.Class.initializer(this.initializerKey,fn)):void 0},PrototypeProperty}(AbstractProperty),InstanceProperty=function(superClass){function InstanceProperty(t,e,r,n,o){var s;this.object=t,this.property=e,this.getter=r,this.setter=n,this.options=o,InstanceProperty.__super__.constructor.apply(this,arguments),(s=this.object)[METADATA]||(s[METADATA]={}),this.metadata=this.object[METADATA],this.target=this.object,this.callbackKey=this.property+"Callback"}return extend(InstanceProperty,superClass),InstanceProperty.prototype.build=function(){return this.defineGetter(),this.defineSetter(),this.defineProperty(),this.defineCallback()},InstanceProperty.prototype.defineCallback=function(){var ref;return this.metadata[this.callbackKey]&&(this.object.off(null,this.metadata[this.callbackKey]),delete this.metadata[this.callbackKey]),this.getter&&this.options.memo&&(null!=(ref=this.options.dependencies)?ref.length:void 0)>0?(eval(' function fn() {\n  this["_'+this.property+'"] = null;\n  this["'+this.property+'"];\n}'),this.metadata[this.callbackKey]=fn,this.object.on(this.toEvents(this.options.dependencies),fn)):void 0},InstanceProperty}(AbstractProperty),Error=function(t){function e(){e.__super__.constructor.call(this,this.message),("function"==typeof e.captureStackTrace?e.captureStackTrace(this,this.name):void 0)||(this.stack=(new e).stack)}return extend(e,t),e}(__root__.Error),ArgumentError=function(t){function e(){this.name="ArgumentError",this.message="[PropertyAccessors] Not enough or invalid arguments",e.__super__.constructor.apply(this,arguments)}return extend(e,t),e}(Error),ReadonlyPropertyError=function(t){function e(t,n){var o;o=r(t)?t.constructor.name||t:t,this.name="ReadonlyPropertyError",this.message="[PropertyAccessors] Property "+o+"#"+n+" is readonly",e.__super__.constructor.apply(this,arguments)}var r;return extend(e,t),r=_.wasConstructed,e}(Error),supportsConst=function(){try{return eval("const BLACKHOLE;"),!0}catch(_error){return!1}}(),eval(supportsConst?"const METADATA = '_' + _.generateID();":"var METADATA = '_' + _.generateID();"),comparator=function(t){var e,r;return r=t.wasConstructed,e=t.isEqual,function(t,n){return r(t)?t===n:e(t,n)}}(_),isFunction=_.isFunction,isClass=_.isClass,isObject=_.isObject,defineProperty=function(t,e,r,n){var o,s,i,a;switch(s=!1,i=!1,arguments.length){case 2:break;case 3:if(isFunction(r))o=r;else{if(!isObject(r))throw new ArgumentError;o=r.get,a=r.set,s=r.memo,i=r.readonly}break;case 4:if(!isObject(r)||!isFunction(n))throw new ArgumentError;o=n,s=r.memo,i=r.readonly}return isFunction(o)||(o=null),isFunction(a)||(a=null),s=!!s,i=!!i,isClass(t)?new PrototypeProperty(t,e,o,a,{memo:s,readonly:i}).build():new InstanceProperty(t,e,o,a,{memo:s,readonly:i}).build()},{property:defineProperty,ArgumentError:ArgumentError,ClassMembers:{property:function(t){var e,r,n;for(e=[this],n=arguments.length,r=-1;++r<n;)e.push(arguments[r]);return defineProperty.apply(null,e)}},InstanceMembers:{_get:function(t){return this["_"+t]},_set:function(t,e){return this[METADATA]["_"+t+"Setter"].call(this,e)}}}})}).call(this);